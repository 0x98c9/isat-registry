name: Validate Student Profile

on:
  pull_request:
    paths:
      - 'students/*.json'

jobs:
  validate-filename:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check for banned filenames
        run: |
          # List of banned usernames
          BANNED_NAMES=(
            "admin" "administrator" "root" "system" "moderator" "mod" 
            "support" "help" "info" "contact" "security" "privacy" 
            "legal" "terms" "about" "status" "blog" "docs" "documentation"
            
            "api" "config" "test" "demo" "dev" "staging" "prod" 
            "null" "undefined" "void" "login" "register" "auth"
            "founder" "ceo" "cto" "owner" "president" "manager"
            "official" "staff" "team" "bot" "noreply" "registry"
            "isat" "isat-college" "isatcollege"

            "google" "alphabet" "microsoft" "apple" "amazon" "facebook" "meta" 
            "netflix" "tesla" "twitter" "x" "instagram" "tiktok" "linkedin" 
            "github" "gitlab" "bitbucket" "openai" "anthropic" "deepmind" 
            "vercel" "netlify" "heroku" "aws" "azure" "gcp" "cloudflare"
            "adobe" "oracle" "ibm" "salesforce" "intel" "amd" "nvidia"
            
            "harvard" "stanford" "mit" "oxford" "cambridge" "yale" 
            "princeton" "caltech" "berkeley" "columbia"
            "university" "college" "school" "academy" "institute"
            
            "badword" "scam" "phishing" "virus" "malware"
          )
          
          # Get changed files in the students directory
          # Using git diff to compare against the base branch
          CHANGED_FILES=$(git diff --name-only origin/${{ github.base_ref }} HEAD | grep '^students/' || true)
          
          if [ -z "$CHANGED_FILES" ]; then
            echo "No student files changed."
            exit 0
          fi

          HAS_ERROR=0
          
          for file in $CHANGED_FILES; do
            # Extract filename without path and extension
            filename=$(basename "$file" .json)
            
            # Check against banned names
            for banned in "${BANNED_NAMES[@]}"; do
              if [[ "$filename" == "$banned" ]]; then
                echo "::error file=$file::The username '$filename' is not allowed."
                HAS_ERROR=1
              fi
            done
            
            # Check for uppercase characters
            if [[ "$filename" =~ [A-Z] ]]; then
              echo "::error file=$file::The username '$filename' must be lowercase."
              HAS_ERROR=1
            fi
            
            # Check for special characters (only alphanumeric and hyphens allowed)
            if [[ ! "$filename" =~ ^[a-z0-9-]+$ ]]; then
              echo "::error file=$file::The username '$filename' contains invalid characters. Only lowercase letters, numbers, and hyphens are allowed."
              HAS_ERROR=1
            fi
          done
          
          if [ $HAS_ERROR -eq 1 ]; then
            exit 1
          fi
